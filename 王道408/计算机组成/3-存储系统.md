# 第三章 存储系统

## 目录
- [第三章 存储系统](#第三章-存储系统)
  - [目录](#目录)
- [3.1 存储器概述](#31-存储器概述)
  - [3.1.1 存储器的分类](#311-存储器的分类)
    - [按在计算机作用分类](#按在计算机作用分类)
    - [按存储介质分类](#按存储介质分类)
    - [按存取方式分类](#按存取方式分类)
    - [按信息的可保存性分类](#按信息的可保存性分类)

# 3.1 存储器概述

## 3.1.1 存储器的分类

### 按在计算机作用分类

### 按存储介质分类

### 按存取方式分类

- 随机存储器（RAM）
  - 存储器任何一个存储单元都可以随机存取，存取时间与存储单元物理位置无关
  - 读/写方便，使用灵活，主要用作主存或高速缓冲存储器
  - 分为静态RAM，动态RAM
- 只读存储器（ROM）
  - 断电保留
  - 随机读取
  - 写入需通过电擦除，速度比读取慢得多
- 串行访问存储器
  - 需按物理位置先后顺序寻址
  - 包括顺序存取存储器（磁带）
  - 直接存取存储器（磁带、光盘）
- 直接存储器（DAM）
  - 速度介于随机存储器和顺序存取存储器之间


### 按信息的可保存性分类

- **易失性存储器**：断电存储信息即消失，RAM
- **非易失性存储器**：断电后信息仍然保持，如ROM、磁表面存储器和光存储器

### 3.1.2 存储器的性能指标

- 三个性能指标
  - 存储容量
  - 单位成本
  - 存储速度
- 相关概念
  - 存储容量 = 存储字数 x 字长
  - 单位成本：位价 = 总成本 / 总容量
  - 存储速度：数据传输速率（每秒传送信息的位数）= 数据的宽度 / 存取周期
    - 存取时间（$T_a$）：从启动一次存储器到完成该操作经历的时间，读出时间、写入时间
    - 存取周期（$T_m$）：指存储器进行一次完整读/写操作所需的全部时间，即连续两次独立访存操作之间所需最短时间间隔
    - 主存带宽（$B_m$）：也称*数据传输速率*，每秒从主存进出信息的最大数量，单位为字/秒或位/秒
  - 存取时间不等于存取周期，通常存取周期大于存取时间。
    - 因为任何一种存储器，读/写操作后，总需要一段时间恢复内部状态。
    - 对于破坏性读出的存储器，存取周期往往比存取时间大得多，因为信息读出后需要马上再生
    - 存取周期 = 存取时间 + 复原时间

## 3.1.3 多级层次的存储系统

- ![多级存储系统](./3-pic/多级存储系统.png)
  - 辅存（硬盘）只能直接和主存（内存）交流信息
  - CPU、Cache、主存相互之间都可以直接交流信息

- 主要思想：上一层存储器作为低一层存储器的高速缓存

- 主存和Cache之间的数据调动是由硬件自动完成的，**对所有程序员均是透明的**
- 主存和辅存之间的数据调动是由硬件和OS共同完成的，**对应用程序员是透明的**
- 虚拟存储系统

## 考点易错点

- 可寻址单元数 = 存储器容量 / CPU寻址单元大小
  - 这里CPU寻址单元大小需要考虑**机器字长**，例如32位机器字长，CPU按半字寻址，那么寻址单元大小为16位
- 相联存储器按**内容**指定方式和**地址**指定方式相结合来寻址
  - 工作原理：存储单元所存内容的某一部分作为检索项（关键字项）去检索该存储器，并将存储器中与该检索项符合的存储单元内容进行写入/读出
  - 一般用于制作TLB、相联Cache
- CPU不能直接访问Cache
- 计算Cache命中率：不能四舍五入，必须命中率往上走
- 几种存储器的名称
  - EPROM
    - 可擦除可编程只读存储器
    - 非易失
    - 像可重复使用的石板，擦除需要特殊的紫外线
  - CD-ROM
    - **只读**光盘
    - 光学存储介质
  - DRAM
    - 动态随机存取存储器
    - 易失性
    - 计算机内存，DDR4、DDR5 —— 高速重复读写
  - SRAM
    - 静态随机存取存储器
    - 易失性
    - 不需要刷新，速度极快，结构复杂成本高功耗大（锁存器电路）

# 3.2 主存储器

## 3.2.1 SRAM和DRAM芯片

主存储器主要由DRAM实现，靠近处理器那一层（Cache）由SRAM实现

### SRAM工作原理

- 概念介绍
  - 存储**一个**二进制位的物理器件称为**存储元**，是存储器最基本的构建
  - 地址码相同的多个**存储元**构成一个**存储单元**，若干存储单元的集合构成**存储体**
- 工作原理
  - 双稳态触发器（六晶体管MOS）来记忆信息
  - **静态**：非破坏性读出
  - SRAM存取速度快，集成度低，功耗较大，价格昂贵，一般用于高速缓冲存储器

### DRAM工作原理

- 基本存储元只使用一个晶体管，集成度高、价位低、功耗小
- DRAM存取速度比SRAM慢，定时刷新+读后再生，必须大容量的主存系统
  - 动态：读操作会使状态发生改变，需要根据读出内容对相应单元进行重写，**读后再生**
- 同一行相邻两次刷新的时间间隔称为**刷新周期**，通常2ms

- 常用刷新方式3种
  - 集中刷新：死时间、死区
  - 分散刷新：工作周期分为两部分，前半用于读/写，后半用于刷新
  - 异步刷新：每个刷新周期内每行仅刷新一次，相邻两行之间刷新时间间隔t，每隔t刷新一次
- DRAM的刷新需要注意
  - 刷新对CPU透明，刷新并不依赖于外部的访问
  - DRAM刷新单位是行，芯片内部自行生成地址
  - 刷新操作类似于读操作，但又有所不同
- DRAM芯片的**地址引脚复用技术**
  - 行地址和列地址通过相同引脚先后分两次输入，地址引脚数可减少一半
