# 第六章 总线

## 目录
- [第六章 总线](#第六章-总线)
  - [目录](#目录)
- [6.1 总线概述](#61-总线概述)
  - [6.1.1 总线的基本概念](#611-总线的基本概念)
    - [总线的定义](#总线的定义)
    - [总线设备](#总线设备)
    - [总线特性](#总线特性)
  - [6.1.2 总线的分类](#612-总线的分类)
    - [按功能层次分类](#按功能层次分类)
    - [按时序控制方式分类](#按时序控制方式分类)
    - [按数据传输方式分类](#按数据传输方式分类)
  - [6.1.3 系统总线的结构](#613-系统总线的结构)
  - [6.1.4 常见总线标准（已从大纲删除）](#614-常见总线标准已从大纲删除)
  - [6.1.5 总线性能指标](#615-总线性能指标)

# 6.1 总线概述

早期计算机各部件单独连线互连，**分散连接**

后来发展出**总线连接**，并提出各类总线标准

## 6.1.1 总线的基本概念

### 总线的定义

- 总线：一组能为多个部件**分时和共享**的公共信息传送线路
  - 分时：同一时刻只允许有一个部件向总线发送信息
  - 共享：总线上可以挂接多个部件，多个部件可同时从总线上接收相同的信息

### 总线设备

- 按对总线有无控制功能可分为主设备从设备两种
  - 主设备：发出总线请求并获得总线控制权的设备
  - 从设备：被主设备访问的设备，只能响应从主设备发来的各种总线命令

### 总线特性

- 是指机械特性（尺寸、形状）、电气特性（传输方向和有效电平范围）、功能特性（每根传输线的功能）和时间特性（信号和时序的关系）

## 6.1.2 总线的分类

### 按功能层次分类

- 片内总线：芯片内部总线
- 系统总线：计算机系统内各功能部件（CPU、主存、I/O接口）之间相互连接的总线
  - 数据总线：各部件传输数据、指令和中断类型号；双向传输总线，数据总线位数反映一次能传送的数据的位数
  - 地址总线：数据总线上源数据或目的数据所在主存单元或I/O端口的地址，是单向传输总线，位数反映最大的寻址空间
  - 控制总线：传输各种命令、反馈和定时信号；典型的控制信号包括时钟、复位、总线请求/允许、中断请求/回答、存储器读/写、I/O读、I/O写、传输确认等
  - 区分数据通路数据总线
- I/O总线
- 通信总线——外部总线

### 按时序控制方式分类

- 同步总线：总线上连接的部件、设备通过**统一的时钟**进行同步，并在规定的**时钟节拍**内进行规定的总线操作
- 异步总线：**信号握手**的方式协调各部件、设备的传输

### 按数据传输方式分类

- 串行总线：一条双向或两条单向，按比特位串行顺序传输
- 并行总线：多条双向传输，多比特位同时传输，效率更高，但是各数据线传输特点可能存在一些差异，如信息位延迟、数据线相互干扰等等
- 并行总线并不一定更快

## 6.1.3 系统总线的结构

### 单总线结构

- **一组**总线：按传送信息不同，则可细分为地址总线、数据总线和控制总线
- 优点：结构简单、成本低、易于接受新的设备
- 缺点：带宽低、负载重，多个部件争用唯一总线，不支持并发操作

### 双总线结构

- 两条总线
  - 主存总线：CPU、主存和通道之间传送数据
  - I/O总线：外部设备与通道之间传送数据
- 优点：低速I/O设备从原单总线分离出来，实现存储器总线和I/O分离
- 缺点：需要增加通道等硬件设备

### 三总线结构

- 各部件之间采用**3条**各自独立的总线来构成**信息通路**
  - 主存总线：CPU和内存之间传送地址、数据和控制信息
  - I/O总线：CPU和各种外设
  - 直接内存访问（DMA）总线：内存和高速外设之间直接传送
- 优点：提高I/O设备的性能，使其更快响应命令，提高系统吞吐量
- 缺点：任意时刻只能使用一种总线，系统工作效率较低

## 6.1.4 常见总线标准（已从大纲删除）

## 6.1.5 总线性能指标

- 总线时钟周期
- 总线时钟频率
- 总线传输周期：一次总线操作所需时间，需要若干总线时钟周期（申请、寻址、传输、结束）
- 总线工作频率：一秒内传送几次数据
- 总线宽度
- 总线带宽：总线带宽 = 总线工作频率 x（总线宽度 / 8）B/s
- 总线复用：地址/数据线复用（一种信号线不同时间传输不同信息）
- 信号线数：所有总线数的总和成为**信号线数**
- 主要性能指标
  - 总线宽度
  - 总线工作频率
  - 总线带宽：最大数据传输速率
  - `总线带宽=总线宽度x总线工作频率`

## 考点&易错点

- 按连接的部件分类
  - 片内总线：用于CPU内部传送
  - 系统总线
    - 数据总线
    - 地址总线
    - 控制总线
  - 通信总线

- 系统总线中数据的传送方向
  - 数据总线：双向，可读取和传出去
  - 地址总线：CPU->主存、外设
  - 控制总线：双向，控制信号、反馈信息
- 主存区分数据和地址的方式
  - 通过总线类型来区分

# 6.2 总线事务和定时

## 6.2.1 总线事务

- 请求总线到完成总线使用的操作序列称为**总线事务**
- 典型的总线事务包括：请求操作、仲裁操作、地址传输、数据传输和总线释放
  - 请求阶段：主设备（CPU或DMA）发出总线传输请求，获得总线控制权
  - 仲裁阶段：总线仲裁机构，决定下一个传输周期的总线使用权
  - 寻址阶段：给出从设备地址及有关命令，启动从模块
  - 传输阶段：主模块和从模块数据交换
  - 释放阶段：主模块有关信息从系统总线撤出，让出总线使用权

## 6.2.2 总线定时

### 同步定时方式

- 优点：传送速度快，具有较高的传输速率；总线控制逻辑简单
- 缺点：主从设备强制性同步；不能及时进行数据通信的有效性检验，可靠性较差
- 适用于总线长度较短，及总线所接部件的存取时间比较接近的系统
- **同步串行通信方式**：发送方直接控制接收方时钟，效率较高但硬件设备更复杂较少采用

### 异步定时方式

- 握手信号
- 优点：总线周期长度可变，能保证两个工作速度相差很大的部件、设备之间可靠地进行信息交换，自动适应时间的配合
- 缺点：比同步控制方式稍复杂，速度比同步定时方式慢
- 请求、回答信号的撤销是否互锁
  - 不互锁方式
  - 半互锁方式
  - 全互锁方式
- 异步串行通信方式
  - 收发双方不严格一致，每个字符开始位停止位

### 半同步定时方式

- 所有地址、命令、数据信号的发出时间都严格参照系统时钟某个**前沿**开始，接收方都采用系统时钟**后沿**时刻进行判断识别
- 优点：控制方式比异步定时简单，各模块在系统时钟控制下同步工作，可靠性较高
- 缺点：系统时钟频率不能要求太高

### 分离式定时方式

- 总线事务分为请求和应答两个子过程
- 优点：不传送时释放总线，使总线可接受其它设备的请求，不存在空闲等待时间
- 缺点：控制复杂，开销也大

## 考点&易错点

- 计算设备的数据传输速率
  - 注意有没有问**有效**数据传输速率
  - 没问那就是包括控制位、校验位都要算
  - 问了就是只看数据位
- 数据传输分为
  - 传输地址：一般是一个时钟周期，由主频可以计算出来
  - 准备数据：由题目给出（需要看支不支持**突发传送**）
  - 传输数据：看带宽来计算
- 突发传送：主设备给出一个首地址，从首地址开始的若干连续单元读出或写入多个数据
  - 减少了地址传送的时间
- PCI-E：采用串行数据包传输