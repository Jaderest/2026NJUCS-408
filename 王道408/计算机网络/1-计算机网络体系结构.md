# 第一章 计算机网络体系结构

## 目录

- [第一章 计算机网络体系结构](#第一章-计算机网络体系结构)
  - [目录](#目录)
- [1.1 计算机网络概述](#11-计算机网络概述)
  - [1.1.1 计算机网络的概念](#111-计算机网络的概念)
  - [1.1.2 计算机网络的组成](#112-计算机网络的组成)
    - [从组成部分上看](#从组成部分上看)
    - [从工作方式](#从工作方式)
    - [从功能组成](#从功能组成)
  - [1.1.3 计算机网络的功能](#113-计算机网络的功能)
  - [1.1.4 电路交换、报文交换与分组交换](#114-电路交换报文交换与分组交换)
    - [电路交换](#电路交换)
    - [报文交换（考：存储转发、数据传送时间的计算）](#报文交换考存储转发数据传送时间的计算)
    - [分组交换](#分组交换)
  - [1.1.5 计算机网络的分类](#115-计算机网络的分类)
    - [按分布范围分类](#按分布范围分类)
    - [按拓扑结构分类](#按拓扑结构分类)
    - [按使用者分类](#按使用者分类)
    - [传输介质分类](#传输介质分类)
  - [1.1.6 计算机网络的性能指标](#116-计算机网络的性能指标)
  - [考点\&易错点](#考点易错点)
- [1.2 计算机网络体系结构与参考模型](#12-计算机网络体系结构与参考模型)
  - [1.2.1 计算机网络分层结构](#121-计算机网络分层结构)
    - [网络体系结构的定义](#网络体系结构的定义)
    - [分层的基本原则](#分层的基本原则)
    - [概念](#概念)
  - [1.2.2 计算机网络协议、接口、服务的概念](#122-计算机网络协议接口服务的概念)
    - [协议](#协议)
    - [接口](#接口)
    - [服务](#服务)
  - [1.2.3 ISO/OSI参考模型和TCP/IP模型](#123-isoosi参考模型和tcpip模型)
    - [OSI参考模型（考：OSI第三层各层中继设备）](#osi参考模型考osi第三层各层中继设备)
    - [TCP/IP模型](#tcpip模型)
    - [TCP/IP和OSI模型的比较](#tcpip和osi模型的比较)
    - [最后采取折中](#最后采取折中)
  - [考点\&易错点](#考点易错点-1)

# 1.1 计算机网络概述

## 1.1.1 计算机网络的概念
- 计算机网络是一个 将众多分散的、自治的计算机系统 通过通信设备与线路**连接**起来，由功能完善的软件实现资源共享和信息传递的 **系统**。
- 计算机网络（简称网络）由如下组成：
  - 若干节点（Node）
    - 可以是计算机、集线器、交换机、路由器等
  - 连接节点的链路（Link）
- 网络之间还可以通过路由器互联，构成一个覆盖范围更广的计算机网络
  - 称为互联网(**internet**) （小写的 i）
- 理解：**网络**把许多**计算机**连在一起，**互联网**把许多**网络**通过路由器连在一起
- 区别**internet**和**Internet**：
  - **internet**：互联网
    - 通用名词，泛指由多个计算机网络互连而成的计算机网络
    - 这些网络之间可以使用任意协议作为通信规则
    - 不一定要TCP/IP
  - **Internet**：专用名词，指当前全球最大的、开放的、由众多网络和路由器互连而成的特定计算机网络
    - 采用TCP/IP族作为通信规则

## 1.1.2 计算机网络的组成
计算机网络的组成可以分为如下几类：

### 从组成部分上看
- 由硬件、软件、协议三大部分组成
- 硬件
  - 主机（端系统）
  - 通信链路（如双绞线、光纤）
  - 交换设备（如路由器、交换机等）
  - 通信处理机（如网卡）等组成
- 软件
  - 主要包括各种实现资源共享的软件和方便用户使用的各种工具软件
  - E-mail、FTP、聊天程序
- 协议
  - 计算机网络的核心
  - 如同交规制约汽车驾驶

### 从工作方式
- 计算机网络（Internet）可分为边缘部分和核心部分
- 边缘部分
  - 所有连接到互联网上的供用户直接使用的主机组成
  - 用来进行通信（如传输数据、音频或视频）&资源共享
- 核心部分
  - 由大量网络和连接这些网络的路由器
  - 为边缘部分提供连通性和交换服务

### 从功能组成
- 计算机网络由通信子网和资源子网两部分组成
- 通信子网
  - 各种传输介质、通信设备和相应网络协议组成
  - 使网络有具有数据传输、交换、控制和存储的能力
  - 实现互联网计算机之间的数据通信
- 资源子网
  - 实现资源共享功能的设备及其软件的集合
  - 向网络用户提供其他计算机上的硬件资源、软件资源和数据资源的服务

## 1.1.3 计算机网络的功能
五大功能：
1. 数据通信
2. 资源共享
3. 分布式处理
4. 提高可靠性——互为体态机
5. 负载均衡

## 1.1.4 电路交换、报文交换与分组交换
网络核心起重要作用的是**路由器**（Router），对收到的分组进行存储转发实现分组交换

### 电路交换
- **交换**就是按某种方式动态分配传输线路的资源
- 电路交换分为三步
  - 建立连接（开始占用通信资源）
    - 数据传输前，两个用户之间必须建立一条**专用的物理通信路径**（双方交换设备和链路逐段连接而成）
  - 传输数据（一直占用通信资源）
    - 传输数据过程中，物理通信路径从始至终被两个用户**独占**，直到通信结束才释放
  - 释放连接（归还通信资源）
- 除源节点和目的节点外，电路上其他任何节点都采取“直通方式”发送和传输，**不存在存储转发**
- 优点
  - 通信时延小：双方专用，数据直达，传输效率高
  - 有序传输：按顺序传送数据，不存在失序问题
  - 没有冲突：不同的通信双方之间拥有不同的信道，不会争用物理信道
  - 实时性强：物理通路建立后可随时通信
- 缺点：
  - 建立连接时间长：需要建立专用的物理通信路径
  - 线路利用率低：线路一直占用，空闲了也不能给其他用户使用
  - 灵活性差：通路中任何一点出现故障，都得重新建立连接
  - 难以实现差错控制：中间节点不具备存储和检验数据的能力

### 报文交换（考：存储转发、数据传送时间的计算）
- 数据交换的单位是**报文**（Message）
  - 用户数据加上源地址、目的地址等信息后，封装成报文
- 报文交换采用**存储转发技术**
  - 报文传送到相邻节点，全部存储后查找转发表，转发到下一个节点，直到达到目的节点
  - 每个报文都可以单独选择到达目的端的路径
- 报文交换技术的优先
  - 无建立连接时延——用户可随时发报文
  - 灵活分配线路——交换节点存储整个报文后，选择一条合适的空闲线路转发，若某条路径故障，则可选择另一条路径传输数据
  - 线路利用率高——传送时才占用通信资源
  - 支持差错控制——中间节点具备存储和检验数据的能力

### 分组交换
- 分组交换也采用**存储转发技术**
- 源主机发送前，将较长的报文划分成若干较小的等长数据段，每个数据段前面添加一些由必要控制信息（如源地址、目的地址和编号信息等）组成的首部，形成**分组**（Packet）
- 源主机将分组发送到分组交换网中，分组交换网中的分组交换机收到一个分组后，将其**缓存**，**从首部提取**目的地址，据此查找自己的**转发表**，发给下一个分组交换机，最终达到目标主机
- 除继承报文交换诸多优点，还有如下优点：
  - 方便存储管理，存储转发开销小——分组长度固定，缓冲区大小也固定
  - 传输效率高——后一个分组的存储与前一个分组的转发操作并行，**流水线方式**减少了报文传输时间
  - 减少出错概率和重传代价——分组段，出错概率必然减小
- 缺点：
  - 存在存储转发时延
  - 需要传输额外的信息量
  - 失序、丢失、重复分组情况

## 1.1.5 计算机网络的分类

### 按分布范围分类
1. 广域网（WAN）
   - 长距离通信，直径几十米~几千千米
   - 互联网核心部分
   - 连接各节点交换机的链路一般都是高速链路，较大通信容量
2. 城域网（MAN）
   - 几个街区甚至整个城市，直径5~50km
   - 大多以太网技术（有时划入局域网范围讨论）
3. 局域网（LAN）
   - 用主机通过高速线路相连，覆盖范围较小
   - 直径几米~几千米
   - 传统上，**局域网使用广播技术**，广域网使用交换技术
4. 个人局域网（PAN）
   - 个人工作地方将消费电子设备（如平板、手机）用无线技术连接起来的网络
   - 也叫无线个人局域网（WPAN）

### 按拓扑结构分类
- 分为总线形、星形、环形、网状形等
- 星形、总线形、环形网络多用于局域网、网状网络多用于广域网
- 总线形网络
  - 单根传输线连接计算机
  - 优点
    - 建网容易
    - 增减节点方便
    - 节省线路
  - 缺点
    - 重负载时通信效率不高
    - 对故障敏感
- 星形网络
  - 每个终端/计算机以单独线路连接中央设备，中央设备一般是交换机或路由器
  - 优点
    - 便于集中控制和管理
  - 缺点
    - 成本高
    - 中央设备对故障敏感
- 环状网络
  - 所有计算机接口设备连接成一个环，最典型例子是令牌环局域网
  - 环可以是单环或双环
  - 环中信号单向传输
- 网状网络
  - 每条节点至少两条路径与其他节点相连
  - 分为规则型和非规则型
  - 优点
    - 可靠性高
  - 缺点
    - 控制复杂
    - 线路成本高

### 按使用者分类
1. 公用网
2. 专用网

### 传输介质分类
- 有线网
  - 双绞线网络
  - 同轴电缆网络
- 无线网
  - 蓝牙
  - 微波
  - 无线电等类型

## 1.1.6 计算机网络的性能指标
- 常用性能指标如下
  - 速率（Speed，数据传输速率、数据率、比特率）
    - 指单位时间内传输的数据量
    - 单位：b/s, bit/s, bps, kb/s, Mb/s, Gbps
  - 带宽（Bandwidth）
    - 数字信道所能传送的“最高数据传输速率”的同义语，b/s
  - 吞吐量（Throughput）（考：吞吐量的分析）
    - 指单位时间内通过某个网络（or信道or接口）的实际数据量
  - 时延（Delay）
    - 指数据从源主机发送到目的主机所需的时间
    - 包括发送时延、传播时延、排队时延和处理时延
  - 时延带宽积（Delay-Bandwidth Product）
    - 发送第一个比特即将到达终点时，发送端已发送多少比特
    - 反映了网络中可以同时传输的数据量
    - 计算公式：时延带宽积 = 时延 × 带宽
  - 往返时延（Round Trip Time, RTT）
    - 指从源主机发送一个分组到目的主机，并收到目的主机的确认分组所需的时间
    - 包括各中间节点的处理时延、排队时延和传播时延
  - 信道利用率
    - 某个信道有百分之多少时间是有数据通过的
    - 信道利用率 = 有数据传输的时间 / 总时间
    - **如果利用率太高反而会产生较大时延，导致网络拥塞**
- 分组交换网中各种时延的计算
  - 发送时延（也叫传播时延）
    - 发送分组第一个比特到分组最后一个比特发送完毕所用时间
    - 发送时延 = 分组长度 / 发送速率
  - 传播时延
    - 传输介质中传播一定距离所花时间
    - 传播时延 = 信道物理长度 / 电磁波在信道上的传播速度
  - 处理时延
    - 分组在交换节点为存储转发进行的一些必要处理所花时间
    - 分析分组首部、差错检验、查找合适路由
  - 排队时延
    - 分组在路由器输入/输出队列中排队等待所花时间
  - 总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延

## 考点&易错点

- 分组传输中：分组大小1000B，分组头大小20B -> 分组携带的数据大小为980B

- **小心1000B和1Mb/s中单位的区别**

- **分组交换的计算**
  - 可以看作流水线，为了方便，假设各流水段时间相同设为r
  - 两主机通信，中间k段链路
  - 传输m各分组用时 t = k*r + (m-1)*r
    - k*r：第一个分组从源主机到目的主机的时间
    - (m-1)*r：后续分组的传输时间

# 1.2 计算机网络体系结构与参考模型

## 1.2.1 计算机网络分层结构

### 网络体系结构的定义
- 计算机网络的各层及其协议的集合称为网络的**体系结构**（Architecture）
  - 计算机网络体系结构通常具有可分层的特性，将复杂的大系统分成若干较容易实现的层次
- 使用何种硬件/软件完成这些功能的，是一个遵循这种体系结构的**实现**问题
  - 体系结构是抽象的、实现是具体的

### 分层的基本原则
  1. 每层都实现相对独立的功能，降低大系统的复杂度
  2. 各层之间接口自然清晰，易于理解，相互交流尽可能少
  3. 各层功能的精确定义独立于具体的实现方法，可以采用最合适的技术实现
  4. 保持下层对上层的独立性，上层单向使用下层提供的服务
  5. 整个分层结构应能促进标准化工作

### 概念
- 网络分层结构中
  - 第n层的活动元素称为**第n层实体**
  - 不同机器上的同一层称为**对等层**
  - 同一层的实体称为**对等实体**
  - n层向n+1层提供的服务**包括**在其以下各层提供的服务
    - n层的实体称为**服务提供者**
    - 服务提供者高一层的实体称为**服务用户**
- **协议数据单元（PDU）**：对等层之间传输的数据单位，n层的PDU记为n-PDU
  - 各层PDU都分为服务数据单元和协议控制信息两部分
- **服务数据单元（SDU）**：层与层之间交换的数据单位，n层的SDU记为n-SDU
- **协议控制单元（PCI）**：控制协议操作的信息，n层的PCI记为n-PCI·
- 每层的PDU都有一个通俗的名称
  - 物理层的PDU：比特流
  - 数据链路层：帧
  - 网络层：分组
  - 传输层：报文段
- 各层传输数据时
  - 发送方
    - n+1层收到的PDU作为n层的SDU，加上n层的PCI(如源地址、目的地址等)形成n层的PDU
    - n层的PDU作为n-1层的SDU，传递给n-1层
  - 接收方相反处理
  - n-SDU + n-PCI = n-PDU = (n-1)-SDU
- 层次结构的含义包括如下几方面
  - n层的实体：使用n-1层的服务实现自身定义的功能，还向n+1层提供服务（服务是n层及下面各层提供服务的总和）
  - 最底层只提供服务，是整个层次结构的基础；最高层面向用户提供服务
  - 上一层只能通过相邻层的接口使用下一层的服务，而不能调用其他层的服务
  - 通信时，对等层在逻辑上有一个直接信道，表现能为能直接将信息传送到对方

## 1.2.2 计算机网络协议、接口、服务的概念

### 协议
- 为了在网络中进行数据交换而建立的这些规则、标准或约定称为**网络协议**
  - 是控制在对等实体之间进行通信的规则的集合，**是水平的**
  - 不对等层间没有协议
- 协议由语法、语义和同步三部分组成
  - **语法**：数据与控制信息的格式。 e.g. TCP报文段格式由TCP语法定义
  - **语义**：需要发出何种控制信息、完成何种动作及做出何种应答。 e.g. TCP握手每次执行的操作由TCP语义定义
  - **同步（或时序）**：执行各种操作的条件、时序关系等，即对事件实现顺序详细说明。 e.g. 建立TCP连接的三次握手的时序关系由TCP的同步定义的

### 接口
- 同一节点内相邻两层的实体交换信息的逻辑接口称为**服务访问点**（Service Access Point, SAP）
- 每层仅能在紧邻的层之间定义接口，而不能跨层定义接口
- 服务通过SAP提供给上层使用，n层的SAP就是n+1层可以访问第n层服务的地方

### 服务
- **服务**是指下层为紧邻的上层提供的功能调用，是垂直的
- 协议和服务的区别
  - 本层协议的实现才能保证向上一层提供服务
  - 本层的服务用户只能看见服务而无法看见下面的协议，下面的协议对上层的服务用户是透明的
  - **协议是水平的**：协议控制对等实体之间通信的规则
  - **服务是垂直的**：服务由下层通过层间接口向上层提供
- 服务的三种分类方式
  - 面向连接服务与无连接服务
    - 面向连接服务：通信前双方应现建立连接，分配相应资源，传输结束后释放连接和占用的资源
      - 可分三个阶段：连接建立、数据传输和连接释放
      - TCP
    - 无连接服务：双方不需要建立连接，需要发送数据时可直接发送，将每个带有目的地址的包（报文分组）传送到线路上，由系统选定路线进行传输。**尽最大努力交付**
      - IP、UDP
  - 可靠服务和不可靠服务
    - **可靠服务**：网络具有纠错、检错、应答机制，保证数据正确、可靠地传送到目的地
    - **不可靠服务**：网络只是尽量让数据正确、可靠地传送到目的地，尽力而为的服务
  - 有应答服务和无应答服务
    - **有应答服务**：接收方收到数据后向发送方给出相应的应答
      - 应答由传输系统内部自动实现，不由用户实现
      - 应答既可以是肯定应答又可以是否定应答
      - e.g. 文件传输服务
    - **无应答服务**：接收方收到数据后不自动给出应答，若需要应答，则由高层实现
      - e.g. WWW服务

## 1.2.3 ISO/OSI参考模型和TCP/IP模型

### OSI参考模型（考：OSI第三层各层中继设备）
- 国际标准化组织（ISO）提出的网络体系结构模型称为**开放系统互连参考模型**（OSI/RM）
  - 简称OSI参考模型，共有七层，自下而上如下
    - 物理层（物）
    - 数据链路层（链）
    - 网络层（网）
    - 传输层（输）
    - 会话层（会）
    - 表示层（示）
    - 应用层（用）
1. 物理层(Physical Layer)
   - 传输单位是**比特**，功能：在物理介质上为数据端设备透明地传输原始比特流
   - 主要研究以下内容
     - 通信链路与通信节点的连接需要一些电路接口，物理层规定这些接口的一些参数
       - 如机械形状和尺寸、引脚数量和排列等，例如网线接口
     - 规定了通信链路上传输信号的意义和电气特征
       - 如信号X代表数字0：节点要传输0时发送信号X，节点收到信号X时知道收到的是0
   - **传输信息所用物理介质（双绞线、光缆、无线信道等）并不在物理层协议之内**——规定信号怎么传、然后标准接口，但是介质用的什么并不用管
2.  数据链路层(Data Link Layer)
   - 传输单位是**帧**，两台主机之间的数据传输总在一段一段的链路上进行，这就需要使用专门的链路层协议
   - 主要作用：加强物理层传输原始比特流的功能，物理层提供的可能出错的物理连接**改造为逻辑上无差错**的数据链路
   - 数据链路将网络层交来的IP分组封装成帧，并**可靠地**传输到相邻节点的网络层，实现节点之间的**差错控制**和**流量控制**的功能
     - **差错控制**：由于外界噪声的干扰，导致原始物理连接在传输过程中受到干扰，导致信号变成另一个信号，接收端收到内容和发送端不一致的比特流，从而发生差错。差错控制可以检测出这些，并**丢弃**错误信息
     - **流量控制**：发送节点发送速率可能比接收速率快，如果不加以控制，B会丢弃很多来不及接收的正确数据，造成传输线路效率下降。流量控制可以协调两个节点速率，使得发送速率刚好是接收速率
   - 如果是广播式网络，数据链路层还要处理如何控制对共享信道的访问
3. 网络层(Network Layer)
   - 传输单位为**数据报**，关心的是通信子网的运行控制，主要任务是将网络层的协议数据单元（分组）从源主机传输到目的主机，为分组交换网上的不同主机提供通信服务。
   - 关键问题是
     - 对分组进行路由分组
     - 实现流量控制、拥塞控制、差错控制和网际互联等功能
   - 既提供有连接可靠的虚电路服务，又提供无连接不可靠的数据报服务
   - 无论哪一层传送的数据单元，**都可以笼统地用“分组”来表示**
   - 流量控制：协调A的发送速率和B的接收速率
   - 拥塞控制：若大部分节点都来不及接收分组而丢弃大量分组，导致节点间无法正常通信，则网络处于拥塞状态
   - 差错控制：通信节点之间约定的特定检错规则，接收方根据该规则检错，若出错，能纠错就纠错，不能纠错就丢弃，**确保数据都是无误的**
4. 传输层(Transport Layer)
   - 传输层也称运输层。负责**主机中两个进程之间**的通信，提供端到端的流量控制、差错控制、连接建立与释放、可靠传输管理等服务，**传输层仅提供有连接可靠的服务**
   - 数据链路层提供点到点通信，传输层提供端到端通信，二者不同
     - **点到点**可理解成主机间通信，一个点是硬件地址/IP地址，网络中参与通信的主机是通过硬件地址或IP地址来标识的
     - **端到端**通信是指运行在不同主机内的两个进程之间的通信，一个进程由一个端口号标识，称为端到端通信
   - 通过传输层屏蔽，高层用户看不到通信子网的交替和变化。因为一个主机同时可运行多个进程，传输层具有**复用和分用**的功能
     - **复用**：多个应用进程同时使用下面传输层的服务
     - **分用**：传输层将收到的信息分别交付给上面应用层中相应进程
5. 会话层(Session Layer)
   - 允许不同主机上各个进程之间进行会话
     - 这种服务主要为表示层实体或用户进程建立连接，并在连接上有序地传输数据，这就是**会话**，也称**建立同步**（SYN）
   - 会话层负责管理主机间的会话进程（包括建立、管理和终止进程间的会话）
   - 会话层包含**检查点**机制维持可靠会话，**断点下载**
6. 表示层(Presentation Layer)
   - 处理不同主机交换信息的表示方式
     - 不同机器采用编码和表示方法不同，为了使不同表示方法的数据和信息之间能够互相交换，表示层采用抽象的标准方法定义数据结构，采用标准的编码形式
   - 数据压缩、加密、解密
7. 应用层(Application Layer)
   - OSI参考模型最高层，用户与网络的接口
   - 为特定类型网络应用提供访问OSI参考模型环境的手段
   - 用户应用多样 -> 应用层采用多种协议满足不同需求，使用的协议最多

### TCP/IP模型
- 广泛应用、事实上的国际标准
- TCP/IP模型从低到高 网络接口层、网际层、传输层、应用层（对应会话层、表示层和应用层）
  |层次|协议|
  |---|---|
  |应用层|HTTP、SMTP（TCP的）、DNS、RTP（UDP）|
  |传输层|TCP、UDP|
  |网际层|IP|
  |网络接口层|网络接口1、2、3|
1. 网络接口层：类似于OSI参考模型的物理层和数据链路层
   - 从主机或节点接收IP分组，发送到指定物理网络上
2. 网际层（主机-主机）：TCP/IP体系结构关键部分
   - 将分组发往任何网络，并为其独立选择合适的路由
   - 不保证分组的有序和可靠（由高层负责）
   - 提供无连接、不可靠的IP
   - 数据传输单位 **IP数据报**
   - IPv4, IPv6
3. 传输层：发送端和目的端主机上的对等实体进行会话（主要是如下两种协议）
   - TCP（Transmission Control Protocol）传输控制协议
     - 面向连接的可靠传输协议
     - 传输单位为**报文段**
   - UDP（User Datagram Protocol）用户数据报协议
     - 无连接的、不可靠的传输协议
     - 尽最大努力交付
     - 传输单位为**用户数据报**
4. 应用层：包含所有高层协议
   - Telnet、FTP、DNS、SMTP、HTTP等

- IP是互联网中核心协议
- TCP/IP可为各式各样的应用提供服务，TCP/IP还允许IP在由各种网络构成的互联网上运行

### TCP/IP和OSI模型的比较
- 相似
  1. 分层的体系结构，分层的功能也大体相似
  2. 基于独立的协议栈的概念
  3. 都可解决异构网络的互联，实现不同厂家的计算机之间的通信
- 不同
  1. OSI最大贡献是精确定义了三个概念：服务、协议和接口
  2. TCP/IP将表示层和会话层功能合并至应用层、数据链路层和物理层合并为网络接口层
  3. OSI先有模型、后有协议规范，通用性良好；TCP/IP现有协议栈、后建立模型，不适合其他非TCP/IP网络
  4. （**重要**）OSI在网络层支持无连接和面向连接的通信，传输层仅支持面向连接；TCP/IP认为可靠性是端到端的问题，网际层仅有无连接的通信模式，但传输层支持无连接和面向连接两部分

### 最后采取折中
- 讨论5层协议的体系结构
  - 物理层
  - 数据链路层
  - 网络层
  - 传输层
  - 应用层

## 考点&易错点
- OSI中数据链路层提供可靠的数据传输服务
  - 在差错检查的基础上，增加了
  - 帧编号确认
  - 重传机制

- 对网络模型进行分层的目标包括
  - 提供标准语言

- 语法——数据格式
- 语义——数据含义
- 同步——数据传输时序